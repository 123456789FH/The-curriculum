<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>توزيع المناهج — الفصل الدراسي</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {font-family: 'Cairo', sans-serif; background: #f5f7fa; margin: 0; padding: 0;}
    .wrap {max-width: 1200px; margin: auto; padding: 20px;}
    .hero {text-align: center; margin-bottom: 20px; background: #1f2d3d; color: white; padding: 20px; border-radius: 12px;}
    .hero img.header-img {max-width: 100%; border-radius: 12px; margin-bottom: 10px;}
    .title {font-weight: 800; font-size: 24px;}
    .subtitle {opacity: 0.85; font-size: 14px;}
    .info-bar, .footer-bar {display: flex; justify-content: center; flex-wrap: wrap; gap: 20px; margin-top: 10px;}
    .info-item, .footer-item {background: #fff; padding: 8px 14px; border-radius: 10px; border: 1px solid #ddd; display: flex; align-items: center; gap: 6px; font-weight: 700;}

    .toolbar {display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center; margin: 18px 0;}
    .group {display: flex; gap: 8px; align-items: center;}
    .btn {cursor: pointer; border:1px solid #ddd; background:#fff; border-radius:10px; padding:8px 12px; font-weight:700}
    .btn:hover {box-shadow:0 0 0 3px rgba(46,126,247,.25)}
    button {user-select:none}

    .grid {display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px;}
    .card {background: #fff; border: 1px solid #ddd; border-radius: 12px; overflow: hidden;}
    .card-header {display: flex; justify-content: space-between; align-items: center; padding: 12px 14px; background: #f8fbff;}
    .badge {background: #e9f0ff; padding: 6px 10px; border-radius: 10px; font-weight: 800;}
    .status {font-weight: 800; font-size: 12px; padding: 6px 10px; border-radius: 999px; background: #eaf9f0; color: #166534;}
    .card-body {padding: 12px 14px;}
    .tiny {font-size: 12px; color: #666; margin-bottom: 8px;}

    /* شرائط الإجازات */
    .tags{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid transparent}
    .chip-holiday{background:#e9fbea;color:#166534;border-color:#cdeccd}
    .chip-break{background:#fff7d6;color:#7c4a03;border-color:#ffe7a8}
    .chip-notice{background:#ffe4e6;color:#9f1239;border-color:#ffd5da}

    .drawer summary {cursor: pointer; font-weight: 800; padding: 8px 10px; background: #f7fafc; border: 1px dashed #d9e3f3; border-radius: 10px;}
    .drawer-body {margin-top: 10px; display: flex; flex-direction: column; gap: 8px;}
    .day {display: flex; align-items: center; gap: 8px;}
    .day label {min-width: 70px; font-weight: 800;}
    .day input {flex: 1; padding: 8px 10px; border: 1px solid #ddd; border-radius: 10px;}
    .chip-delete {background: #fff1f2; color: #9f1239; border: 1px solid #ffd5da; border-radius: 10px; padding: 6px 8px; cursor: pointer; font-size: 12px;}
    .day.is-holiday input{background:#f0fdf4;border-color:#bbf7d0}

    .actions {display: flex; gap: 8px; padding: 12px 14px; border-top: 1px solid #ddd; background: #fcfdff;}

    /* طباعة */
    @media print{body{background:#fff}.toolbar,.info-bar,.footer-bar,.hero img.header-img{display:none!important}.wrap{max-width:1000px}.grid{grid-template-columns:repeat(2,1fr);gap:12px}.card{box-shadow:none;border:1px solid #ccc;page-break-inside:avoid}}
    @page{size:A4;margin:12mm}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="hero">
      <img class="header-img" src="https://c.top4top.io/p_3510xq5a01.png" alt="صورة أعلى الصفحة">
      <div class="title">التقويم الدراسي التفاعلي — توزيع المناهج</div>
      <div class="subtitle">يحفظ تلقائيًا في المتصفح • مناسب للطباعة على A4 </div>
      <div class="info-bar">
        <div class="info-item">🏫 الصف: <input type="text" placeholder="اسم الصف" style="border:none;outline:none"></div>
        <div class="info-item">📚 المادة: <input type="text" placeholder="اسم المادة" style="border:none;outline:none"></div>
      </div>
    </header>

    <div class="toolbar">
      <div class="group">
        <label>الفصل:</label>
        <select id="term">
          <option>الفصل الأول 1447</option>
          <option>الفصل الثاني 1447</option>
        </select>
      </div>
      $1<div class="group">
        <label>الاتجاه:</label>
        <select id="orientation">
          <option value="portrait">عمودي</option>
          <option value="landscape">أفقي</option>
        </select>
      </div>
      <div class="group">
        <button id="printBtn" type="button" class="btn" aria-label="طباعة">🖨️ طباعة A4</button>
        <button id="undoBtn" type="button" class="btn" aria-label="تراجع">↩️ تراجع</button>
      </div>
    </div>

    <section id="weeks" class="grid"></section>
    <div class="footer-bar">
      <div class="footer-item">👩‍🏫 اسم المعلم/ة: <input type="text" placeholder="اسم المعلم/ة" style="border:none;outline:none"></div>
      <div class="footer-item">👨‍💼 اسم المدير/ة: <input type="text" placeholder="اسم المدير/ة" style="border:none;outline:none"></div>
    </div>
  </div>

  <template id="week-tpl">
    <article class="card" data-week>
      <div class="card-header">
        <span class="badge" data-week-title></span>
        <span class="status" data-status>جاهز</span>
      </div>
      <div class="card-body">
        <div class="tiny" data-range></div>
        <div class="tags" data-tags></div>
        <details class="drawer">
          <summary>عرض التفاصيل</summary>
          <div class="drawer-body">
            <div class="day"><label>الأحد</label><input placeholder="الموضوع"><button type="button" class="chip-delete btn" data-clear-day>حذف</button></div>
            <div class="day"><label>الاثنين</label><input placeholder="الموضوع"><button type="button" class="chip-delete btn" data-clear-day>حذف</button></div>
            <div class="day"><label>الثلاثاء</label><input placeholder="الموضوع"><button type="button" class="chip-delete btn" data-clear-day>حذف</button></div>
            <div class="day"><label>الأربعاء</label><input placeholder="الموضوع"><button type="button" class="chip-delete btn" data-clear-day>حذف</button></div>
            <div class="day"><label>الخميس</label><input placeholder="الموضوع"><button type="button" class="chip-delete btn" data-clear-day>حذف</button></div>
          </div>
        </details>
      </div>
      <div class="actions">
        <button type="button" class="btn" data-toggle>عرض التفاصيل</button>
        <button type="button" class="btn" data-delete>حذف</button>
      </div>
    </article>
  </template>

  <script>
  document.addEventListener('DOMContentLoaded', ()=>{
    const weeksEl = document.getElementById('weeks');
    const printBtn = document.getElementById('printBtn');
    const undoBtn = document.getElementById('undoBtn');
    const searchInp = document.getElementById('search');
    const orientSel = document.getElementById('orientation');

    const weeksData = [
      "24/8 - 28/8", "1/9 - 5/9", "8/9 - 12/9", "15/9 - 19/9", "21/9 - 25/9", "28/9 - 2/10",
      "5/10 - 9/10", "12/10 - 16/10", "19/10 - 23/10", "26/10 - 30/10", "2/11 - 6/11",
      "9/11 - 13/11", "16/11 - 20/11", "23/11 - 27/11", "30/11 - 4/12", "7/12 - 11/12",
      "14/12 - 18/12", "21/12 - 25/12", "28/12 - 1/1"
    ];

    const HOLIDAYS = {
      5:  [{type:'holiday', label:'إجازة اليوم الوطني (٤ أيام)'}],
      8:  [{type:'notice',  label:'إجازة رسمية - يوم واحد'}],
      13: [{type:'notice',  label:'بداية إجازة الخريف - نهاية دوام الخميس', days:[4]}],
      14: [{type:'break',   label:'إجازة الخريف - أسبوع'}],
      16: [{type:'break',   label:'إجازة الشتاء - ١٤ يوم'}],
      19: [{type:'notice',  label:'إجازة منتصف الفصل - تبدأ نهاية دوام الخميس', days:[4]}]
    };

    let historyStack = [];
    const saveSnapshot = ()=>{ historyStack.push(weeksEl.innerHTML); if(historyStack.length>5) historyStack.shift(); };

    function setPrintOrientation(orientation){
      let style = document.getElementById('print-orientation-style');
      if(!style){ style = document.createElement('style'); style.id = 'print-orientation-style'; document.head.appendChild(style); }
      const cols = orientation==='landscape' ? 3 : 2;
      style.textContent = `@page{size: A4 ${orientation}; margin:12mm}
@media print{ .grid{grid-template-columns:repeat(${cols},1fr)!important} }`;
    }

    function applyHolidays(card, num){
      const entries = HOLIDAYS[num];
      const tags = card.querySelector('[data-tags]');
      if(!entries){ return; }
      entries.forEach(ent=>{
        const chip = document.createElement('span');
        chip.className = `chip chip-${ent.type}`;
        chip.textContent = ent.label;
        tags.appendChild(chip);
        if(ent.days && ent.days.length){
          const dayRows = card.querySelectorAll('.day');
          ent.days.forEach(idx=>{
            const row = dayRows[idx];
            if(row){
              row.classList.add('is-holiday');
              const inp = row.querySelector('input');
              if(inp && !inp.value) inp.placeholder = 'إجازة';
            }
          });
        }
      });
    }

    function renderWeeks(){
      weeksEl.innerHTML='';
      for(let i=1; i<=19; i++){
        const tpl = document.getElementById('week-tpl').content.cloneNode(true);
        const node = tpl.firstElementChild;
        node.querySelector('[data-week-title]').textContent = `الأسبوع ${i}`;
        node.querySelector('[data-range]').textContent = weeksData[i-1] || '';
        weeksEl.appendChild(node);
        applyHolidays(node, i);
      }
      saveSnapshot();
    }
    renderWeeks();

    weeksEl.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const card = e.target.closest('[data-week]');
      if(!card) return;
      if(btn.matches('[data-toggle]')){ e.preventDefault(); card.querySelector('details').open = !card.querySelector('details').open; }
      else if(btn.matches('[data-delete]')){ e.preventDefault(); saveSnapshot(); if(confirm('حذف هذه البطاقة؟')) card.remove(); }
      else if(btn.matches('[data-clear-day]')){ e.preventDefault(); const input = btn.closest('.day').querySelector('input'); if(input) input.value=''; }
    });

    searchInp && searchInp.addEventListener('input', ()=>{
      const q = searchInp.value.trim();
      weeksEl.querySelectorAll('[data-week]').forEach(c=>{ c.style.display = c.innerText.includes(q)?'':'none'; });
    });

    printBtn && printBtn.addEventListener('click', (ev)=>{
      ev.preventDefault(); ev.stopPropagation();
      setPrintOrientation(orientSel ? orientSel.value : 'portrait');
      setTimeout(()=>{ try{ window.focus(); window.print(); }catch(_){} }, 0);
    });

    undoBtn && undoBtn.addEventListener('click', (ev)=>{ ev.preventDefault(); if(historyStack.length){ weeksEl.innerHTML = historyStack.pop(); } });
  });
  </script>
</body>
</html>
